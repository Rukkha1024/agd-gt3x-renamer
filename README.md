# ActiGraph 파일 자동 이름 변경 프로그램

ActiGraph 파일의 이름을 자동으로 변경하는 Python 스크립트입니다.

## 📋 기능

- ActiGraph 파일명에 대상자 이름 자동 추가
- Excel 파일 기반 자동 매칭 (고유번호 → 관리번호 → 이름)
- 구분(주차)별 필터링으로 1:N 관계 해결
- Dry-run 모드로 안전한 미리보기
- 이미 변경된 파일 자동 건너뛰기

## 🔄 파일명 변경 규칙

**변경 전:**
```
MOS2D36155148 (2025-11-13).gt3x
MOS2D36155148 (2025-11-13)60sec.agd
```

**변경 후:**
```
JB54017302_김선옥 (2025-11-13).gt3x
JB54017302_김선옥 (2025-11-13)60sec.agd
```

## 📁 필요한 파일

1. **대상자 키,체중,주손 정보.xlsx**
   - 연도별 시트 (2024, 2025)
   - 필수 컬럼: 구분, 관리번호, ID, 이름

2. **관리번호-시리얼번호.xlsx**
   - 필수 컬럼: 관리번호, 고유번호

3. **config.yaml**
   - 파일 경로 및 설정

## 🚀 사용 방법

### 1. 필수 패키지 설치

```bash
pip install pandas pyyaml openpyxl
```

### 2. Dry-run 모드로 미리보기

```bash
python rename_actigraph_files.py --week "40주차" --year 2025 --dry-run
```

### 3. 실제 파일 변경

```bash
python rename_actigraph_files.py --week "40주차" --year 2025
```

### 4. 다른 주차 처리

```bash
python rename_actigraph_files.py --week "1주차" --year 2024
```

## ⚙️ 설정 파일 (config.yaml)

```yaml
paths:
  subject_info: "경로/대상자 키,체중,주손 정보.xlsx"
  serial_mapping: "경로/관리번호-시리얼번호.xlsx"
  target_directory: "경로/ActiGraph/ActiLife/Downloads"

columns:
  serial_mapping:
    management_number: "관리번호"
    serial_number: "고유번호"
  subject_info:
    division: "구분"
    management_number: "관리번호"
    id: "ID"
    name: "이름"

file_extensions:
  - ".gt3x"
  - ".agd"

defaults:
  year: 2025
```

## 🔍 매칭 프로세스

```
파일명: MOS2D36155148 (2025-11-13).gt3x
   ↓
1. 고유번호 추출: MOS2D36155148
   ↓
2. 관리번호 조회 (관리번호-시리얼번호.xlsx)
   고유번호: MOS2D36155148 → 관리번호: 105
   ↓
3. ID와 이름 조회 (대상자 키,체중,주손 정보.xlsx)
   관리번호: 105 + 구분: 40주차 → ID: JB54017302, 이름: 김선옥
   ↓
4. 새 파일명 생성
   JB54017302_김선옥 (2025-11-13).gt3x
```

## 🛡️ 안전 기능

- ✅ 이미 변경된 파일 자동 감지 및 건너뛰기
- ✅ Dry-run 모드로 실제 변경 전 미리보기
- ✅ 매칭 실패 시 자세한 오류 메시지 출력
- ✅ 처리 결과 요약 통계 제공

## 📊 출력 예시

```
============================================================
ActiGraph 파일 자동 이름 변경
============================================================
📅 연도: 2025
📌 구분: 40주차
🔍 모드: DRY-RUN (미리보기)
============================================================

📂 데이터 로드 중...
  ✓ 관리번호-시리얼번호 매칭: 126 건
  ✓ 대상자 정보 (2025년): 1006 건
📁 발견된 파일: 10개

✅ [DRY-RUN] MOS2D36155148 (2025-11-13).gt3x -> JB54017302_김선옥 (2025-11-13).gt3x
⏭️  JB54017302_김선옥 (2025-11-13)60sec.agd: 이미 변경됨

============================================================
📊 처리 결과
============================================================
✅ 성공: 1개
⏭️  건너뜀: 1개
❌ 실패: 0개
============================================================
```

## 🔧 문제 해결

### 고유번호를 찾을 수 없음

- `관리번호-시리얼번호.xlsx` 파일에 해당 고유번호가 있는지 확인
- 파일명 형식이 올바른지 확인 (예: `고유번호 (날짜).확장자`)

### 이름을 찾을 수 없음

- 연도와 구분(주차) 값이 올바른지 확인
- `대상자 키,체중,주손 정보.xlsx`의 해당 연도 시트에 데이터가 있는지 확인
- 관리번호와 구분 조합이 정확한지 확인

### 파일 경로를 찾을 수 없음

- `config.yaml`의 경로가 올바른지 확인
- WSL 환경에서는 `/mnt/c/...` 형식 사용
- Windows 환경에서는 `C:/...` 형식 사용

## 📝 명령행 옵션

```
--week, --division    구분 값 (필수, 예: "40주차")
--year               연도 (선택, 기본값: config.yaml)
--dry-run            실제 변경 없이 미리보기만 수행
--config             설정 파일 경로 (기본값: config.yaml)
```

## 📄 라이선스

이 프로그램은 질병관리청 연구 프로젝트용으로 개발되었습니다.
