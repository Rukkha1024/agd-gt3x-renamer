# Example of Modifying .gt3x Files

The `.gt3x` file is a compressed zip format containing an internal `log.bin` and `info.txt`. `info.txt` is a simple text file storing device information in a `Key: Value` format on each line. According to ActiGraph documentation, `info.txt` stores the device's **Serial Number**, firmware version, battery voltage, sampling rate, start/stop times, and various metadata such as **Subject Name**. During initialization, the GT3X+ device can selectively store **additional biometric information** such as sex, height, weight, date of birth, race, wear location (wrist/waist/ankle, etc.), wear side (left/right), and limb dominance. This information is included in the compressed `.gt3x` file along with `info.txt`.

Another set of metadata exists within the `log.bin` file. `log.bin` is a binary file consisting of various types of packets; among them, **METADATA (Packet ID 6)** is an area reserved for storing arbitrary metadata. This packet contains a UTF-8 encoded JSON string. In examples, it is stored as a JSON object with fields such as `SubjectName`, `Race`, `Limb`, `Side`, and `Dominance`. Fields like `Sex`, `Height`, `Mass`, and `Age` output by R packages like `read.gt3x` or `SummarizedActigraphy` are read from this JSON field in the METADATA packet.

### Feasibility of Modifying `.gt3x` Metadata

1.  **Viewing Serial Number** – The first line of `info.txt` is always the device's serial number. Therefore, you can easily check it by changing the `.gt3x` extension to `.zip` or unzipping it with the `zipfile` module to open `info.txt`. This value is a unique number assigned at manufacturing, so it is recommended not to modify it.

2.  **Modifying Subject Name and Basic Info** – Since `info.txt` is plain text, you can modify it using Python's `zipfile` and `io` modules as follows:

    ```python
    import zipfile, json, io, re

    # Unzip gt3x file into memory
    with zipfile.ZipFile("original.gt3x", "r") as zf:
        info_data = zf.read("info.txt").decode("utf-8").splitlines()
        log_bin   = zf.read("log.bin")

    # Modify info.txt (e.g., Change Subject Name)
    new_lines = []
    for line in info_data:
        if line.startswith("Subject Name:"):
            new_lines.append("Subject Name: NewName")
        elif line.startswith("Height:"):
            new_lines.append("Height: 182")        # Example in cm
        elif line.startswith("Weight:"):
            new_lines.append("Weight: 75")         # Example in kg
        else:
            new_lines.append(line)
    new_info = "\n".join(new_lines).encode("utf-8")

    # Modifying the first METADATA packet in log.bin – Finding and changing JSON
    # This example shows a simple dump method to find and modify the JSON string.
    # In reality, additional work like updating checksums is required.
    idx = log_bin.find(b'{"MetadataType"')
    end = log_bin.find(b'}', idx) + 1
    metadata_json = json.loads(log_bin[idx:end].decode("utf-8"))
    metadata_json.update({
        "SubjectName": "NewName",
        "Height": "182",
        "Mass": "75",
        "Sex": "Male",
        "Race": "White",
        "Limb": "Wrist",
        "Side": "Right",
        "Dominance": "Dominant"
    })
    new_json_bytes = json.dumps(metadata_json).encode("utf-8")
    # You must update the packet header, size, and checksum to match the new JSON length
    
    # Inserting new JSON into log.bin... (Omitted here)

    # Save as new gt3x file
    with zipfile.ZipFile("modified.gt3x", "w") as zf:
        zf.writestr("info.txt", new_info)
        zf.writestr("log.bin", log_bin)  # Use new_log_bin if log.bin was modified
    ```

    The example above explains the basic structure. **You must recalculate the header and checksum of the METADATA packet** for it to become a valid `.gt3x` file. ActiGraph places a 1-byte checksum after the packet payload, which is the 1's complement XOR of the header and payload. Therefore, when modifying the JSON, you must recalculate the packet size field and checksum. Since almost no open-source tools support this, this task requires forensic-level binary modification experience. Alternatively, it is relatively easier to extract data using the R package `read.gt3x` and then re-compress a new `info.txt` with modified metadata.

3.  **Additional Info (Dominant hand/foot, height, weight, etc.)** – According to the ActiLife manual, GT3X+ devices can store sex, height, weight, date of birth, race, wear location and side, and dominance during the initialization phase. This information is stored together in `info.txt` and the metadata within `log.bin`. Therefore, you can change this information by modifying `info.txt` and the METADATA packet in the manner described above.

### Summary

*   **Feasibility** – The GT3X file is a simple zip format, so you can unzip and modify the files programmatically. You can easily change the subject name and some metadata in `info.txt` and save it again as `.gt3x`. The device's serial number is directly visible in `info.txt`, but it is a unique device value, so it is better not to modify it.

*   **Modifying Additional Biometric Info** – To change sex, height, weight, limb dominance, etc., you need to modify the JSON stored in the METADATA packet of `log.bin`. This is more complex than simple text modification because it requires recalculating the packet size and checksum. It is possible if you write appropriate parser and binary manipulation code, but there are no officially supported tools.

*   **Recommendation** – For research data analysis purposes, it is more stable to convert the `.gt3x` to `.agd`/SQLite or CSV, modify the metadata there, and manage that information with a separate metadata file during analysis.
