# ActiGraph 파일 이름 자동 변경 프로젝트

## 📁 참조 파일

```yaml
대상자_정보_파일: "C:\Users\ding0\대학원생_김종철\OneDrive - 청주대학교\질병관리청\대상자 키,체중,주손 정보.xlsx"
  - 시트: 2024, 2025
  - 컬럼: 구분, 관리번호, ID, 이름, 성별, 나이, 키, 체중, 생년월일, 주손, 지급일, 착용 시작일, 착용시작 요일

관리번호_시리얼_매칭_파일: "C:\Users\ding0\OneDrive\문서\vscode repository\관리번호-시리얼번호.xlsx"
  - 컬럼: 관리번호, 고유번호

대상_디렉토리: "C:\Users\ding0\OneDrive\문서\ActiGraph\ActiLife\Downloads"
```

---

## 🔄 파일명 변경 로직

### 1. 기존 파일명 형식
```
고유번호 (날짜).확장자
```

**예시:**
- `MOS2D36155148 (2025-11-13).gt3x`
- `MOS2D36155148 (2025-11-13)60sec.agd`

### 2. 변경 후 파일명 형식
```
ID_이름 (날짜).확장자
```

**예시:**
- `JB54017302_김선옥 (2025-11-13).gt3x`
- `JB54017302_김선옥 (2025-11-13)60sec.agd`

---

## ⚙️ 매칭 프로세스

```
1. 파일명에서 고유번호 추출
   예: "MOS2D36155148 (2025-11-13).gt3x" → 고유번호: MOS2D36155148

2. 관리번호-시리얼번호.xlsx에서 관리번호 찾기
   고유번호: MOS2D36155148 → 관리번호: 105

3. 대상자 키,체중,주손 정보.xlsx (연도별 시트)에서 매칭
   - 조건1: 관리번호 = 105
   - 조건2: 구분 = "40주차" (CLI 옵션으로 입력)
   → 결과: 김선옥

4. 새 파일명 생성
   JB54017302_김선옥 (2025-11-13).gt3x
```

---

## 🚨 핵심 문제 및 해결방안

### 문제: 1:N 관계
- 하나의 **관리번호**에 **여러 명의 대상자**가 매칭됨
- 예: 관리번호 105 → 김보민, 홍민수, 오경은, 김선옥 (총 4명)

### 해결: "구분" 컬럼으로 필터링
- **구분** 컬럼: "1주차", "2주차", "40주차" 등의 값
- **CLI 옵션**으로 구분 값을 입력받아 필터링

**사용 예시:**
```bash
python name.py -- 40주차 --year 2025
```

---

## 📋 Python 스크립트 요구사항

### 기능
1. CLI 옵션:
   - `--week` 또는 `--division`: 구분 값 (예: "40주차")
   - `--dry-run`: 실제 변경 없이 미리보기

2. 처리 대상 파일:
   - `.gt3x` 파일
   - `.agd` 파일

3. 안전장치:
   - 이미 이름이 변경된 파일은 건너뛰기 (파일명에 `_`와 한글이 포함된 경우)
   - 매칭 실패 시 로그 출력 및 건너뛰기
   - dry-run 모드로 먼저 확인 가능

4. 재사용성:
   - config.yaml로 경로 및 설정 관리
   - 단일 스크립트로 구현

---

## ✅ 테스트 완료 케이스

**파일:** `MOS2D36155148 (2025-11-13).gt3x`

**매칭 결과:**
```
ID: JB54017302
관리번호: 105
구분: 40주차
이름: 김선옥
```

**변경 완료:**
- ✅ `JB54017302_김선옥 (2025-11-13).gt3x`
- ✅ `JB54017302_김선옥 (2025-11-13)60sec.agd`

---

## 📝 다음 단계

1. [x] config.yaml 파일 생성
2. [x] Python 스크립트 작성 (name.py)
3. [x] dry-run 모드로 테스트
4. [x] 실제 파일 변경 실행